## <ins>Configure the Cartridge

### **Prerequisite**
If you are new to Cybersource, and would like to start using Cybersource Cartridge quickly, begin by [signing up for a Sandbox Account](https://developer.cybersource.com/hello-world/sandbox.html).

You will also need to create an [p12 file](https://developer.cybersource.com/docs/cybs/en-us/platform/developer/all/rest/rest-getting-started/restgs-jwt-message-intro/restgs-security-p12-intro/restgs-security-P12.html) that you can use to authenticate requests to our sandbox server. Follow same steps to generate Production key and shared secret.

### Step 1: Setup Cartridge Path

To set up the cartridge path:
1. In the Business Manager, go to **Administration >  Sites >  Manage Sites > [yourSite] > Settings**

2. For the Cartridges, enter **int_cybersource_sfra:app_storefront_base** and select **Apply**

### Step 2: Upload metadata
Cybersource cartridge installed from Market place comes with metadata to import. 
1. Go to **Cybersource/metadata/sfra_meta/sites/** folder.
2. Rename **yourSiteID** folder name with your site ID in Business Manager (this can be found by looking up **Administration->Sites->Manage Sites**)
3. Zip **sfra_meta** folder.
4. Go to **Administration->Site Development->Site Import & Export** and upload **sfra_meta.zip** file.
5. Import the uploaded zip file.

On successful import, it creates following metadata.

- Site Preferences (Cybersource, Cybersource_SecureAcceptance, Cybersource_Paypal, Cybersource_GooglePay, Cybersource_Klarna, Cybersource_VisaCheckout, Cybersource_BankTransfer, Cybersource_PayerAuthentication, Cybersource_WeChat, Cybersource_Tokenization, Cybersource_DecisionManager, Cybersource_TaxConfiguration, Cybersource_DeliveryAddressVerification, Cybersource_DeviceFingerprint, Cybersource_Alipay)
- Service (cybersource.conversiondetailreport, cybersource.soap.transactionprocessor.generic, cybersource.http.flextoken,cybersource.assymentrickeymanagement)
- Payment Processor (KLARNA_CREDIT, CYBERSOURCE_ALIPAY, BANK_TRANSFER, CYBERSOURCE_WECHAT)
- Payment Method
- Job (CyberSource: Decision Manager Order Update)

#### Cybersource Core (Required)

Step 1: Upload Cybersource metadata in Business Manager. If not follow ["Step 2: Upload metadata"](Configure-cartridge.md#step-2-upload-metadata) or import **"metadata/sfra_meta/meta/Cybersource.xml"** in Business Manager (**Administration > Site Development > Import & Export**)

Step 2: Go to **Merchant Tools >Site Preferences Custom Preferences > Cybersource** and set values for the following parameters:

Field | Description
------------ | -------------
Enable Cybersource Cartridge | Enable or disable Cyberdource Cartridge. If disabled none of the Cybersource services are invoked
Cybersource Merchant ID | Cybersource Merchant ID
CsKeystore_Name | Name of the keystore file added in webreferences2 folder.
CsAuth_Alias | 1. If MLE is enabled, then extract the Alias of the client certificate in JKS file for Authentication (<Merchant_ID>) 2. If MLE is disabled and you are choosing to use PKCS12 keystore for Authentication, then extract Friendly name from p12 (run openssl pkcs12 -in CyberSourceTransaction.pkcs12 -info in terminal to extract friendly name of p12 key uploaded in webreferences2 folder.) Use the serialNumber and CN of the friendly name returned. Ex: serialNumber=1690399296411018724102,CN=sfcc_cybs
CsKeystore_Password | Password of the keystore file
CsAuth_KeystoreType | Type of keystore for Authentication (PKCS12 or JKS). NOTE: Use only JKS type if MLE is enabled.
CsMLE_Enabled | Enable or Disable Message-Level Encryption
CsJKS_MLEAlias | Alias of the certificate in JKS file (cybersource_sjc_us)
CyberSource Endpoint | Select Test(Test) or Production(Production)
CyberSource Developer ID | Unique identifier generated by Cybersource for System Integrator
CyberSource Disable Debug logging | Some trace information will be stored in the impex folder on the server with the order ID as the name.
CyberSource Master Card Auth Indicator | Preauthorization: 0 passed in request. Final authorization: 1 passed in request. Undefined authorization: omit authIndicator field from the request message
CsTransactionType |	Select Auth/Sale transaction for Credit card

#### Services (Required)

Step 1: Upload Cybersource metadata in Business Manager. If not follow ["Step 2: Upload metadata"](Configure-cartridge.md#step-2-upload-metadata) or import **"metadata/sfra_meta/services.xml"** in Business Manager (**Administration >  Operations >  Import & Export**).

Step 2: Go to **Administration >  Operations >  Services** 

Step 3: Make sure service with name  **cybersource.soap.transactionprocessor.generic** exist.


#### Payment Processor (Required)

Step 1: Upload Cybersource metadata in Business Manager. If not follow ["Step 2: Upload metadata"](Configure-cartridge.md#step-2-upload-metadata) or import **"metadata/sfra_meta/sites/yourSiteID/payment-processors.xml"** in Business Manager (**Merchant Tools >  Ordering >  Import & Export**).



<div style="text-align: right;font-size: 20px" ><a href="Configure-payment-method.md">Next Step: Configure the Payment method</a></div> 



---